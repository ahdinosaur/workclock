"use strict";

var Ractive = require('ractive');
require('ractive-backbone');
var validation = require('backbone-validation');

var fs = require('fs');

var TaskList = require('./TaskList');

module.exports = Ractive.extend({
  template: fs.readFileSync(__dirname + '/TaskList.html'),

  init: function (options) {
    var tasks = options.tasks || new TaskList();
    this.adaptors = ['Backbone'];

    this.set({ tasks: tasks });

    this.on({
      // bind create
      add: function (event) {
        var task = tasks.add({});
        console.log("task add", task);
      },
      // bind destroy
      remove: function (event) {
        tasks.get(event.context).destroy();
      },
      // bind save
      modified: function (event) {
        console.log('modified');
        tasks.get(event.context).save();
      },
    });

    // bind view to collection
    validation.bind(this, {
      collection: tasks,
    });
  }
});
