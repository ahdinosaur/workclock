"use strict";

var expect = require('chai').expect;
var sinon = require('sinon');

var Task = require('../Task');
var TaskList = require('../TaskList');
var TaskListView = require('../TaskListView');

describe("TaskListView", function() {
  var taskView, taskList;

  before(function() {
    // create element for task view to bind to
    var taskEl = document.createElement('div');
    taskEl.className = 'tasks';
    document.body.appendChild(taskEl);

    // create new task list and reset
    taskList = new TaskList();
    taskList.reset();

    // create new task view
    taskView = new TaskListView({
      el: taskEl,
      tasks: taskList,
    });
  });

  describe('clicking the plus button twice', function() {

    before(function() {

      // create a new initialize function for task model
      // that will allow us to spy on .save()
      var init = Task.prototype.initialize;
      Task.prototype.initialize = function () {
        sinon.spy(this, 'save');
        init.apply(this, arguments);
      };

      sinon.spy(taskList, 'add');
      taskView.el.querySelector('button.add').click();
      taskView.el.querySelector('button.add').click();
    });

    it("should create two empty tasks", function() {
      expect(taskList.add.calledTwice).to.be.true;
      expect(taskView.el.querySelectorAll('form.task-form')).length.is.equal(2);
      expect(taskList.models.length).is.equal(2);
    });

    it("should not save the tasks to the server", function() {
      expect(taskList.models[0].save.called).to.be.false;
      expect(taskList.models[1].save.called).to.be.false;
    });
    
    /*
    describe("editing the task", function() {
      beforeEach(function() {

      });

      it("should save the task to the server", function() {

      });
    });
    */
  });
});
